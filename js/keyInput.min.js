class NumInput{constructor(){this._cursor=document.createElement('div');this._cursor.classList.add("keyCursor");document.body.appendChild(this._cursor,document.body.firstElementChild);this._valbox=document.createElement('div');this._valbox.classList.add("valbox");this._valbox.innerHTML='0'
document.body.appendChild(this._valbox,document.body.firstElementChild);let inputAll=document.querySelectorAll('.numInput');inputAll.forEach((e)=>{let inputBox=document.createElement('div');inputBox.classList.add("inputBox");let el=e.cloneNode(false)
inputBox.appendChild(el,inputBox.firstElementChild);e.parentNode.insertBefore(inputBox,e);e.parentNode.removeChild(e);})
this._input;this._keyBoard=document.createElement("div");this._keyBoard.classList.add("keyBoard");this._keyBoard.innerHTML=`<div><span class="close">close</span></div><div class="keyBox"><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>x</div><div>0</div><div>de</div></div>`;document.body.appendChild(this._keyBoard,document.body.firstElementChild);document.addEventListener('click',ev=>{if(ev.target.className==='numInput'){console.log('点击输入框');this._input=ev.target;let inputStyle=window.getComputedStyle(this._input);this._valbox.style.cssText+=`font-size:${inputStyle.fontSize};font-weight:${inputStyle.fontSize};font-family:${inputStyle.fontFamily};letter-spacing:${inputStyle.letterSpacing};position:fixed;`
this._valbox.innerHTML='0'
this._oneWordWidth=window.getComputedStyle(this._valbox).width.replace("px","");this.showKey(1);this._cursor.style.display='block';this._cursor.style.top=this._input.offsetTop+'px';this._cursor.style.height=this._input.clientHeight+'px';let e=ev||window.ev;console.log({'x':e.screenX,'y':e.screenY});this.cursorPositionLeft(e.screenX);}else if(ev.target.parentNode.className==='keyBox'){return}else{console.log('点击键盘关闭按钮或其他区域');this._cursor.style.display='none';this.showKey(2);}})
this._keyBoard.addEventListener('click',ev=>{if("0123456789x".indexOf(ev.target.innerText)>-1){this.setValue(ev.target.innerText);}else{this.deleteValue();this.cursorPositionLeft();}})}
showKey(onlyShow){if(onlyShow==1){this._keyBoard.style.display='block';this._keyBoard.style.height='201px';return}else if(onlyShow==2){this._keyBoard.style.height='0';setTimeout(()=>{this._keyBoard.style.display='none';},150);return}
if(this._keyBoard.style.display=='block'){this._keyBoard.style.height='0';setTimeout(()=>{this._keyBoard.style.display='none';},150);}else{console.log(this);this._keyBoard.style.display='block';this._keyBoard.style.height='201px';}}
setValue(val){console.log('123',this._input.value.length,this._valbox.innerHTML.length);if(this._input.value.length>this._valbox.innerHTML.length>0){this._input.value=this._valbox.innerHTML+val+this._input.value.substr(this._valbox.innerHTML.length,this._input.value.length)
this.cursorPositionLeft('',val);}else{this._input.value=this._valbox.innerHTML=this._input.value+val;this._valbox.innerHTML=this._input.value;this.cursorPositionLeft()}}
deleteValue(){if(this._input.value.length>this._valbox.innerHTML.length>0){this._input.value=this._valbox.innerHTML.substr(0,this._valbox.innerHTML.length-1)+this._input.value.substr(this._valbox.innerHTML.length,this._input.value.length);this._valbox.innerHTML=this._valbox.innerHTML.substr(0,this._valbox.innerHTML.length-1)
this.cursorPositionLeft();}else{this._input.value=this._input.value.substr(0,this._input.value.length-1);this._valbox.innerHTML=this._input.value;this.cursorPositionLeft()}}
cursorPositionLeft(Cleft,val){if(Cleft){let cliLeft=Cleft-this._input.offsetLeft;let cursorL=parseFloat(cliLeft/this._oneWordWidth-1);this._valbox.innerHTML=this._input.value.substr(0,cursorL);}else{if(val){this._valbox.innerHTML=this._valbox.innerHTML+val;}}
this._cursor.style.left=parseInt(window.getComputedStyle(this._valbox).width)+this._input.offsetLeft+'px';}}